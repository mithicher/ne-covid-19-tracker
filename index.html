<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="title" content="Northeast COVID19 Tracker">
	<meta name="description" content="COVID19 Coronavirus Pandemic stats from Northeast India. Track total confirmed, active, recovered and death cases in the Northeast region of India.">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="refresh" content="900">

	<title>Northeast COVID19 Tracker</title>

	<link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
	<link rel="manifest" href="manifest.json">

	<meta name="mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="application-name" content="CV19-NE">
	<meta name="apple-mobile-web-app-title" content="CV19-NE">	
	<meta name="msapplication-starturl" content="/">
	 
	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://covid19northeast.netlify.com/">
	<meta property="og:title" content="Northeast COVID19 Tracker">
	<meta property="og:description" content="COVID19 Coronavirus Pandemic stats from Northeast India. Track total confirmed, active, recovered and death cases in the Northeast region of India.">

	<!-- Twitter -->
	<meta property="twitter:url" content="https://covid19northeast.netlify.com/">
	<meta property="twitter:title" content="Northeast COVID19 Tracker">
	<meta property="twitter:description" content="COVID19 Coronavirus Pandemic stats from Northeast India. Track total confirmed, active, recovered and death cases in the Northeast region of India.">

	<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />

	<link rel="stylesheet" href="tailwind.css">
	<script src="alpine.js" defer></script>
	<style>
		[x-cloak] {
			display: none;
		}
		.rounded-lg {
			border-radius: 0.75rem;
		}
	</style>
</head>

<body class="antialiased sans-serif bg-gray-300">
	<div x-data="app()" x-init="getDataByState()" x-cloak class="flex flex-col min-h-screen">		 
		<div class="flex-1">

			<!-- Header -->
			<div class="bg-blue-900">
				<div class="container mx-auto px-4 pt-4 md:pt-12 pb-20">
					<div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4">
						<div>
							<h1 class="text-2xl text-gray-300 font-bold mb-1 md:mb-0">Northeast COVID-19 Tracker</h1>
							<div x-text="'Last updated: '+ formatDateAndTime(lastRefreshed)" class="text-gray-500 text-xs"></div>
						</div>
					</div>
				</div>
			</div>	
			<!-- /Header -->

			<div class="px-4">
				<div class="container mx-auto py-10 -mt-24">

					<div class="px-4 pt-5 bg-white rounded-lg shadow mb-5" style="min-height: 300px;">
						<div class="font-bold uppercase tracking-wide text-gray-800 mb-2">India</div>
						<div id="chart" class="-ml-4 -mr-2"></div>
					</div>

					<div class="px-4 pt-3 pb-0 md:py-3 bg-white rounded-lg shadow mb-5"> 
						<div class="font-bold uppercase tracking-wide text-gray-800 mb-2">India</div>
						 
						<div class="flex flex-wrap border-t md:border-t-0">
							<div class="w-1/2 md:w-1/4 py-2 md:py-0 border-b md:border-b-0">
								<div class="font-bold uppercase text-xs tracking-wide text-gray-600">Confirmed</div>
								<div>
									<span class="font-bold text-2xl md:text-3xl text-red-500" x-text="formatNumber(summary.confirmed)"></span>
									<span class="font-bold text-sm text-red-500" x-text="'[' + formatNumber(summary.deltaconfirmed) +']'"></span>
								</div>
							</div>
							<div class="border-l w-1/2 md:w-1/4 py-2 md:py-0 pl-4 border-b md:border-b-0">
								<div class="font-bold uppercase text-xs tracking-wide text-gray-600">Active</div>
								<div class="font-bold text-2xl md:text-3xl text-blue-500" x-text="formatNumber(summary.active)"></div>
							</div>
							<div class="md:border-l w-1/2 md:w-1/4 py-2 md:py-0 md:pl-4">
								<div class="font-bold uppercase text-xs tracking-wide text-gray-600">Recovered</div>
								<div>
									<span class="font-bold text-2xl md:text-3xl text-green-500" x-text="formatNumber	(summary.recovered)"></span>
									<span class="font-bold text-sm text-green-500" x-text="'[' + formatNumber(summary.deltarecovered) +']'"></span>
								</div>
							</div>
							<div class="border-l w-1/2 md:w-1/4 py-2 md:py-0 pl-4">
								<div class="font-bold uppercase text-xs tracking-wide text-gray-600">Deaths</div>
								<div>
									<span class="font-bold text-2xl md:text-3xl text-gray-500" x-text="formatNumber	(summary.deaths)"></span>
									<span class="font-bold text-sm text-gray-500" x-text="'[' + formatNumber(summary.deltadeaths) +']'"></span>
								</div>
							</div>
						</div>
					</div>

					<template x-for="(state, stateIndex) in states" :key="stateIndex">	
						<div class="px-4 pt-3 pb-0 md:py-3 bg-white rounded-lg shadow mb-5">
							<div class="flex mb-2 justify-between items-center">
								<div class="truncate font-bold uppercase tracking-wide text-gray-800" x-text="state.state"></div>
								<div>
									<a href="#" @click.prevent="triggerModal(state.state)" class="font-semibold text-xs uppercase tracking-wide text-blue-500 hover:text-blue-700">View Details</a>
								</div>
							</div>
							<div class="flex flex-wrap border-t md:border-t-0">
								<div class="w-1/2 md:w-1/4 py-2 md:py-0 border-b md:border-b-0">
									<div class="font-bold uppercase text-xs tracking-wide text-gray-600">Confirmed</div>
									<div class="font-bold text-2xl md:text-3xl text-red-500" x-text="formatNumber(state.confirmed)"></div>
								</div>
								<div class="border-l w-1/2 md:w-1/4 py-2 md:py-0 pl-4 border-b md:border-b-0">
									<div class="font-bold uppercase text-xs tracking-wide text-gray-600">Active</div>
									<div class="font-bold text-2xl md:text-3xl text-blue-500" x-text="formatNumber(state.active)"></div>
								</div>
								<div class="md:border-l w-1/2 md:w-1/4 py-2 md:py-0 md:pl-4">
									<div class="font-bold uppercase text-xs tracking-wide text-gray-600">Recovered</div>
									<div class="font-bold text-2xl md:text-3xl text-green-500" x-text="formatNumber(state.recovered)"></div>
								</div>
								<div class="border-l w-1/2 md:w-1/5 py-2 md:py-0 pl-4">
									<div class="font-bold uppercase text-xs tracking-wide text-gray-600">Deaths</div>
									<div class="font-bold text-2xl md:text-3xl text-gray-500" x-text="formatNumber(state.deaths)"></div>
								</div>
							</div>
						</div>	
					</template>
				</div>
			</div>
		</div>

		<!-- Footer -->
		<div class="container mx-auto px-4 py-10">
			<p class="text-gray-600">Made in Guwahati by <a class="text-blue-500 hover:text-blue-600" href="https://twitter.com/mithicher">@mithicher</a>. Powered by api from <a class="text-blue-500 hover:text-blue-600" href="https://api.covid19india.org/">https://api.covid19india.org/</a></p>
		</div>
		<!-- /Footer -->

		<!-- Modal -->
		<div style=" background-color: rgba(0, 0, 0, 0.8)" class="fixed z-40 right-0 left-0 bottom-0 h-full w-full" x-show.transition.opacity="openModal" @click="openModal = false">
			<div class="p-4 max-w-xl mx-auto relative absolute left-0 right-0 overflow-hidden mt-16">
				<div class="shadow absolute z-20 right-0 top-0 w-10 h-10 rounded-full bg-white text-gray-500 hover:text-gray-800 inline-flex items-center justify-center cursor-pointer"
					x-on:click="openModal = false">
					<svg class="fill-current w-8 h-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
						<path
							d="M16.192 6.344L11.949 10.586 7.707 6.344 6.293 7.758 10.535 12 6.293 16.242 7.707 17.656 11.949 13.414 16.192 17.656 17.606 16.242 13.364 12 17.606 7.758z" />
					</svg>
				</div>

				<div class="shadow w-full rounded-lg bg-white w-full block overflow-y-auto" style="height: 420px">
					<div class="sticky top-0 bg-white pt-4 shadow-sm px-8 pb-2">		
						<div x-text="districtState" class="text-xl font-bold mb-2 text-gray-800"></div>
						<div class="flex py-1 justify-between items-center">
							<div class="font-semibold text-xs uppercase text-gray-500 tracking-wide">District</div>
							<div class="font-semibold text-xs uppercase text-gray-500 tracking-wide">Confirmed</div>
						</div>
					</div>

					<div class="px-8 pt-2 pb-8">
						<template x-for="(district, index) in districtData" :key="index">	
							<div class="flex py-2 border-b border-gray-200 justify-between items-center">
								<div class="text-sm uppercase text-gray-700 tracking-wide" x-text="district.district"></div>
								<div class="text-sm uppercase pr-4 text-gray-700 tracking-wide" x-text="district.confirmed"></div>
							</div>
						</template>
					</div>
				</div>
			</div>
		</div>
		<!-- /Modal -->
	</div>

	<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
	<script>
		const neStates = [
			"Assam",
			"Sikkim",
			"Meghalaya",
			"Nagaland",
			"Mizoram",
			"Tripura",
			"Arunachal Pradesh",
			"Manipur"
		];
		const MONTH_NAMES = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

		var isMobile = { 
			Android: function() { return navigator.userAgent.match(/Android/i); }, 
			BlackBerry: function() { return navigator.userAgent.match(/BlackBerry/i); }, 
			iOS: function() { return navigator.userAgent.match(/iPhone|iPad|iPod/i); }, 
			Opera: function() { return navigator.userAgent.match(/Opera Mini/i); }, 
			Windows: function() { return navigator.userAgent.match(/IEMobile/i); }, 
			any: function() { 
				return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows()); 
			} 
		};

		function app() {
			return {
				casesTimeSeries: [],
				states: [],
				summary: {},
				districtData: [],
				districtState: '',
				lastRefreshed: '',
				openModal: false,

				getDataByState() {
					fetch('https://api.covid19india.org/data.json')
						.then(response => response.json())
						.then(data => {
							this.summary = data.statewise[0];
							this.lastRefreshed = data.statewise[0].lastupdatedtime;
							
							this.states = data.statewise.filter(d => {
								if (neStates.includes(d.state)) {
									return d;
								}
							}).sort((a, b) => b.confirmed - a.confirmed);

							this.casesTimeSeries['confirmed'] = data.cases_time_series.slice(Math.max(data.cases_time_series.length - 10, 0)).map(ts => ts.dailyconfirmed);
							
							this.casesTimeSeries['recovered'] = data.cases_time_series.slice(Math.max(data.cases_time_series.length - 10, 0)).map(ts => ts.dailyrecovered);
							
							this.casesTimeSeries['death'] = data.cases_time_series.slice(Math.max(data.cases_time_series.length - 10, 0)).map(ts => ts.dailydeceased);
							
							this.casesTimeSeries['dates'] = data.cases_time_series.slice(Math.max(data.cases_time_series.length - 10, 0)).map(ts => ts.date);

							this.drawSeriesChart();
							// console.log(cases_time_series);
						});
				},

				triggerModal(stateName) {
					this.openModal = true;
					fetch('https://api.covid19india.org/v2/state_district_wise.json')
						.then(response => response.json())
						.then(data => {
							let result = data.filter(d => {
								if (d.state === stateName) {
									return d.districtData.sort((a, b) => b.confirmed - a.confirmed);
								}
							});

							this.districtData = result[0].districtData;
							this.districtState = result[0].state;
						});
				},
			
				formatNumber(number) {
					return new Intl.NumberFormat().format(number);
				},

				formatDateAndTime(date) {
					if (!date) {
    					return null;
					}
					
					let t = date.split(/[/ :]/);
					let reformattedDate = new Date(
						parseInt(t[2]), 
						parseInt(t[1])-1, 
						parseInt(t[0]), 
						parseInt(t[3]), 
						parseInt(t[4]), 
						parseInt(t[5])
					);

					const DAY_IN_MS = 86400000; // 24 * 60 * 60 * 1000
					const today = new Date();
					const yesterday = new Date(today - DAY_IN_MS);
					const d = new Date(reformattedDate);
					const day = d.getDate();
					const month = MONTH_NAMES[d.getMonth()];
					 
					const seconds = Math.round((today - d) / 1000);
  					const minutes = Math.round(seconds / 60);
					const hours = Math.round(minutes / 60);

					if (seconds < 60) {
						return `${seconds}s ago, ${month} ${day}`;
					} else if (minutes < 60) {
						return `${minutes}m ago, ${month} ${day}`;
					} else {
						return `${hours}h ago, ${month} ${day}`;
					}
				},

				drawSeriesChart() {
					let options = {
						series: [
							{
								name: 'Daily Confirmed',
								data: this.casesTimeSeries['confirmed']
							}, {
								name: 'Daily Recovered',
								data: this.casesTimeSeries['recovered']
							}, {
								name: 'Daily Deaths',
								data: this.casesTimeSeries['death']
							}
						],
						chart: {
							type: 'area',
							stacked: false,
							height: isMobile.any() ? 300 : 350,
							zoom: {
								enabled: false
							},
						},
						stroke: {
							width: 2,
							curve: 'smooth'
						},
						dataLabels: {
							enabled: false
						},
						fill: {
							type: 'gradient',
							gradient: {
								shadeIntensity: 1,
								inverseColors: false,
								opacityFrom: 0.45,
								opacityTo: 0.05,
								stops: [20, 100, 100, 100]
							},
						},
						labels: this.casesTimeSeries['dates'],
						tickPlacement: 'between',
						xaxis: {
							// type: 'category',
							// categories: this.casesTimeSeries['dates']
						},
						// yaxis: {
						// 	labels: {
						// 		formatter: (value) => { return value + 'k'; }
						// 	}
						// },
						title: {
							text: 'Last 10 days cases',
							align: 'left',
							offsetX: 6
						},
						legend: {
							position: 'top',
							horizontalAlign: 'right',
							offsetX: 32
						}
					};

					var chart = new ApexCharts(document.querySelector("#chart"), options);
					chart.render();
				}
			}
		}
	</script>
</body>
</html>